// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
{% if interface_imports %}
{% for import_path in interface_imports %}
import "{{ import_path }}";
{% endfor %}
{% else %}
import "../interface.sol";
{% endif %}

// @KeyInfo - Total Lost : {{ total_lost }}
// Attacker : {{ attacker_address_link }}
// Attack Contract : {{ attack_contract_address_link }}
// Vulnerable Contract : {{ vulnerable_contract_address_link }}
// Attack Tx: {{ attack_tx_hash }}
// Withdrawal Tx: {{ withdrawal_tx_hash }}

// @Info
// Vulnerable Contract Code : {{ vulnerable_contract_code }}

// @Analysis
// Post-mortem : {{ post_mortem_links }}
// Twitter Guy : {{ twitter_links }}
// Hacking God : {{ hacking_god_link }}

contract {{ exploit_name }}_{{ year }}_{{ month }}_Exploit_{{ vulnerability_id }} is Test {
    {{ target_contract_name }} public target;
    address public attacker;
    address public attackContract;
{% if additional_state_vars %}
    {{ additional_state_vars }}
{% endif %}

    function setUp() public {
        target = {{ target_contract_name }}({{ vulnerable_contract_address }});
        attacker = {{ attacker_address }};
        attackContract = {{ attack_contract_address }};
        vm.deal(address(this), 100 ether);
        vm.deal(attacker, 100 ether);
{% if additional_setup %}
        {{ additional_setup }}
{% endif %}
    }

    function testExploit_{{ vulnerability_id }}() public {
        uint256 beforeBalance = address(target).balance;
        uint256 attackerBeforeBalance = attacker.balance;

        console.log("[-] Before: target bal=%s attacker bal=%s", beforeBalance, attackerBeforeBalance);

        // Step 1: {{ step_1_description }}
        {{ step_1_code }}

        // Step 2: {{ step_2_description }}
        {{ step_2_code }}

        uint256 afterBalance = address(target).balance;
        uint256 attackerAfterBalance = attacker.balance;

        console.log("[+] After: target bal=%s attacker bal=%s", afterBalance, attackerAfterBalance);

        // Verify exploit succeeded
        {{ invariant_check }}
    }
}

